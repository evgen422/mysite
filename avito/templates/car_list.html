<!doctype html>
{% load widget_tweaks %}
{% load static %}
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Avito sim</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <style>

        </style>
    </head>



    <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Evgeny Artemev</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="/portfolio/">Portfolio</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/avito/car-list/">Avito sim</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Projects
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#">Something else here</a></li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
            </li>
          </ul>
          <form class="d-flex">
            <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success" type="submit">Search</button>
          </form>
        </div>
      </div>
    </nav>



    <!-- Main Content -->
    <div class="container-fluid my-4">
      <div class="row">
        <!-- Left Search Column -->
        <div class="col-md-4 mb-3" style="width: 28rem;">
          <div class="row">
            <div class="col-md-4 mb-3" style="width: 13rem;">
              <h4>Search Filters</h4>
            </div>
            <div class="col-md-4 mb-3" style="width: 10rem;">
              <form method="post" id="refresh-form">
                {% csrf_token %}
                <input type="hidden" name="refresh" value="1">
                <button type="submit" class="btn btn-primary">Refresh</button>
              </form>
            </div>
          </div>

          <form method="post" id="search-form" name="search-form">
            {% csrf_token %}
            <div class="form-group">
              <label for="{{ form.city.id_for_label }}">City:</label>
              {% render_field form.city|add_class:"form-control custom-select" %}  
                          
              <label for="{{ form.make.id_for_label }}">Make:</label>
              {% render_field form.make|add_class:"form-control custom-select" %}

              <label for="{{ form.model.id_for_label }}">Model:</label>
              {% render_field form.model|add_class:"form-control custom-select" %}

              <div class="row">
                <div class="col-md-4 mb-3" style="width: 10rem;">
                  <label for="{{ form.year_min.id_for_label }}">Year min:</label>
                  {% render_field form.year_min|add_class:"form-control" %} 
                </div>
                <div class="col-md-4 mb-3" style="width: 10rem;">
                  <label for="{{ form.year_max.id_for_label }}">Year max:</label>
                  {% render_field form.year_max|add_class:"form-control" %} 
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3" style="width: 10rem;">
                  <label for="{{ form.mileage_min.id_for_label }}">Mileage min:</label>
                  {% render_field form.mileage_min|add_class:"form-control" %} 
                </div>
                <div class="col-md-4 mb-3" style="width: 10rem;">
                  <label for="{{ form.mileage_max.id_for_label }}">Mileage max:</label>
                  {% render_field form.mileage_max|add_class:"form-control" %}  
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 mb-3" style="width: 10rem;">
                  <label for="{{ form.power_min.id_for_label }}">Power min:</label>
                  {% render_field form.power_min|add_class:"form-control" %}   
                </div>
                <div class="col-md-4 mb-3" style="width: 10rem;">
                  <label for="{{ form.power_max.id_for_label }}">Power max:</label>
                  {% render_field form.power_max|add_class:"form-control" %} 
                </div>
              </div> 

              <div class="row">
                <div class="col-md-4 mb-3" style="width: 10rem;">
                  <label for="{{ form.price_min.id_for_label }}">Price min:</label>
                  {% render_field form.price_min|add_class:"form-control" %}   
                </div>
                <div class="col-md-4 mb-3" style="width: 10rem;">
                  <label for="{{ form.price_max.id_for_label }}">Price max:</label>
                  {% render_field form.price_max|add_class:"form-control" %} 
                </div>
              </div>  

              <label for="{{ form.type.id_for_label }}">Type:</label>
              {% render_field form.type|add_class:"form-control custom-select" %}

              <label for="{{ form.wd.id_for_label }}">Wheel drive:</label>
              {% render_field form.wd|add_class:"form-control custom-select" %} 

              <label for="{{ form.fuel.id_for_label }}">Fuel:</label>
              {% render_field form.fuel|add_class:"form-control custom-select" %}


            </div>

            <!--button type="submit" class="btn btn-primary">Apply Filters</button-->
          </form>
        </div>

        <!-- Right Results Column -->
        <div class="col-md-8">
          <h4>Search Results</h4>
          <div class="row">
            <!-- Loop through results and create cards for each -->
            {% for car in cars %}
            
            <div class="card" style="width: 60rem; height: 300px; flex-direction: row;">
              <img src="{% url 'img_view' car.id %}" class="card-img-top rounded-end rounded-bottom" alt="..." style="width: 300px; height: 225px;"> 
              
              <div class="card-body">
                <h5 class="card-title" style="font-size: 24px; color: #009cf0;">{{ car.make }} - {{ car.model }}, {{ car.year }}</h5>
                <h3 class="card-title" style="font-size: 24px;">{{ car.price }} â‚½ </h5>
                <p class="card-text">{{ car.mileage }}km, {{ car.power }}h.p. {{ car.type }}, {{ car.wd }}, {{ car.fuel }}, {{ car.city }}</p>
                <p class="card-text" style="max-height: 100px; overflow: hidden;">{{ car.comment_text }}</p>
                <a href="#" class="btn btn-primary">View Details</a>
              </div>
            </div>
            {% empty %}
            <li>No cars found.</li>

            {% endfor %}
          </div>
        </div>
      </div>
    </div>


    <script>
        $(document).ready(function() {
            $('#id_city, #id_make, #id_model, #id_year_min, #id_year_max, #id_mileage_min, #id_mileage_max, #id_power_min, #id_power_max, #id_price_min, #id_price_max, #id_type, #id_wd, #id_fuel').change(function() {
                $.ajax({
                    type: "POST",
                    url: "{% url 'car_list' %}",
                    data: $('#search-form').serialize(),
                    success: function(response) {
                        $('body').html(response);

                       
                    },
                    error: function() {
                        // Handle error
                        console.error('Failed to submit data.');
                        }
                });
            });
        });

    </script>
    </body>
</html>

<!--To automatically send a request to the server when the value of the 'make' select field changes, you can use jQuery to listen for the 'change' event on the select field, and then use AJAX to asynchronously send the form data to the server.

In the above code snippet, we use jQuery to listen for the 'change' event on the 'make' select field with the ID `id_make`. When the select field changes, we use AJAX to post the serialized form data to the server at the URL specified by `% url 'your_view' %`. You should replace `'your_view'` with the name of the URL pattern that corresponds to the view that handles the form data.

The `$('#your_form').serialize()` line serializes the form data into a URL-encoded string, which is sent as the request parameters to the server.

-->





